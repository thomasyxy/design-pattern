<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>小明追MM的故事</title>
  </head>
  <body>
    <script type="text/javascript">
      //不用代理模式
      // var Flower = function(){};
      // var xiaoming = {
      //   sendFlower: function(target){
      //     var flower = new Flower();
      //     target.receiveFlower(flower);
      //   }
      // };
      //
      // var A = {
      //   receiveFlower: function(flower){
      //     console.log('收到花' + flower);
      //   }
      // };
      //
      // xiaoming.sendFlower(A);

      //使用代理模式，但在此毫无用处
      // var Flower = function(){};
      // var xiaoming = {
      //   sendFlower: function(target){
      //     var flower = new Flower();
      //     target.receiveFlower(flower);
      //   }
      // };
      //
      // var B = {
      //   receiveFlower: function(flower){
      //     A.receiveFlower(flower);
      //   }
      // };
      //
      // var A = {
      //   receiveFlower: function(flower){
      //     console.log('收到花' + flower);
      //   }
      // }
      //
      // xiaoming.sendFlower(B);

      //使用代理模式监听A的心情
      var Flower = function(){};

      var xiaoming = {
        sendFlower: function(target){
          var flower = new Flower();
          target.receiveFlower(flower);
        }
      };

      var B = {
        receiveFlower: function(flower){
          A.listenGoodMood(function(){
            A.receiveFlower(flower);
          });
        }
      };

      var A = {
        receiveFlower: function(flower){
          console.log('收到花' + flower);
        },
        listenGoodMood: function(fn){
          setTimeout(function(){
            fn();
          }, 1000)
        }
      };

      xiaoming.sendFlower(B);
    </script>
  </body>
</html>
